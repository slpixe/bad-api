<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Page - Settings</title>
</head>
<body>
<h1>Admin page - Settings</h1>

<form id="settingsForm">
    <fieldset>
        <legend>Network Settings</legend>
        <div>
            <label for="networkDelay">Network Delay (seconds):</label>
            <input type="range" id="networkDelay" name="networkDelay" required min="0" max="180">
            <span id="networkDelayValue">?</span> seconds
        </div>
    </fieldset>
</form>

<input type="range" id="slider2" min="0" max="100">
<input type="checkbox" id="checkbox1">
<input type="text" id="textInput1">

<script src="http://localhost:3001/socket.io/socket.io.js"></script>
<script>
    // Debounce function
    function debounce(func, delay) {
        let timeout;
        return function(...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
        };
    }

    // const socket = io();
    const socket = io('http://localhost:3001');

    // Elements to sync
    const elements = [
        { id: 'networkDelay', event: 'input', type: 'range' },
        { id: 'slider2', event: 'input', type: 'range' },
        { id: 'checkbox1', event: 'change', type: 'checkbox' },
        { id: 'textInput1', event: 'input', type: 'text' }
    ];

    // Function to sync element value with server
    function syncElement(element) {
        const el = document.getElementById(element.id);

        const emitChange = debounce(() => {
            const value = element.type === 'checkbox' ? el.checked : el.value;
            socket.emit('elementChanged', { id: element.id, value });
        }, 300); // Adjust the delay as necessary

        el.addEventListener(element.event, emitChange);

        // Update display of networkDelay value
        // if (element.id === 'networkDelay') {
        //     el.addEventListener('input', () => {
        //         document.getElementById('networkDelayValue').textContent = el.value;
        //     });
        // }
    }

    // Initialize all elements to sync
    elements.forEach(element => {
        syncElement(element);
    });

    // Listen for updates from server
    socket.on('elementUpdate', (data) => {
        const el = document.getElementById(data.id);
        if (el) {
            if (data.type === 'checkbox') {
                el.checked = data.value;
            } else {
                el.value = data.value;
                // Update display of networkDelay value from server update
                if (data.id === 'networkDelay') {
                    document.getElementById('networkDelayValue').textContent = data.value;
                }
            }
        }
    });
</script>
</body>
</html>
